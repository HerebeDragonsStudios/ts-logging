"use strict";var __spreadArray=this&&this.__spreadArray||function(t,r,o){if(o||2===arguments.length)for(var e,n=0,i=r.length;n<i;n++)!e&&n in r||((e=e||Array.prototype.slice.call(r,0,n))[n]=r[n]);return t.concat(e||Array.prototype.slice.call(r))},errors_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.logSync=exports.logAsync=exports.StopWatch=void 0,require("../errors")),logging_1=require("./logging"),constants_1=require("./constants"),StopWatch=function(){function t(){}return t.prototype.start=function(){this.startTime=Date.now()},t.prototype.check=function(){if(!this.startTime)throw new Error("StopWatch didnt start");return Date.now()-this.startTime},t.prototype.stop=function(){var t=this.check();return this.startTime=void 0,t},t}();function logAsync(g,s){return void 0===g&&(g=constants_1.LOGGER_LEVELS.DEBUG),s||"boolean"!=typeof g||(s=g,g=constants_1.LOGGER_LEVELS.DEBUG),function(t,a,r){var o=r.value;r.value=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=t.pop();if(!e||"function"!=typeof e)throw new errors_1.CriticalError("Missing Callback");var n,i=this.name&&"Function"!==this.name?this.name:this.constructor&&this.constructor.name||this;(0,logging_1.getLogger)().report("[{0}] - Entering Method {1} with args: {2}",g,i,a,t.map(function(t){return t.toString()}).join(" | "));s&&(n=new StopWatch).start(),o.call.apply(o,__spreadArray(__spreadArray([this.__originalObject||this],t,!1),[function(t){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];if(n&&(0,logging_1.getLogger)().report("[{0}][BENCHMARK] - Leaving Method {1} after {2}ms",g,i,a,n.stop()),t)return(0,logging_1.getLogger)().report("[{0}][ERROR] - Leaving Method {1} with error {2}",g,i,a,t),e(t);(0,logging_1.getLogger)().report("[{0}] - Leaving Method {1} with results: {2}",g,i,a,r?r.map(function(t){return t.toString()}).join(" | "):"void"),e.apply(void 0,__spreadArray([void 0],r,!1))}],!1))}}}function logSync(g,s){return void 0===g&&(g=constants_1.LOGGER_LEVELS.DEBUG),s||"boolean"!=typeof g||(s=g,g=constants_1.LOGGER_LEVELS.DEBUG),function(t,i,r){var a=r.value;r.value=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o,e=this.name&&"Function"!==this.name?this.name:this.constructor&&this.constructor.name||this,n=((0,logging_1.getLogger)().report("[{0}] - Entering Method {1} with args: {2}",g,e,i,t.map(function(t){return t.toString()}).join(" | ")),void 0);s&&(n=new StopWatch).start();try{o=a.call.apply(a,__spreadArray([this.__originalObject||this],t,!1))}catch(t){throw n&&(0,logging_1.getLogger)().report("[{0}][BENCHMARK] - Leaving Method {1} after {2}ms",g,e,i,n.stop()),(0,logging_1.getLogger)().report("[{0}][ERROR] - Leaving Method {1} with error {2}",g,e,i,t),t}return n&&(0,logging_1.getLogger)().report("[{0}][BENCHMARK] - Leaving Method {1} after {2}ms",g,e,i,n.stop()),(0,logging_1.getLogger)().report("[{0}] - Leaving Method {1} with results: {2}",g,e,i,o||"void"),o}}}exports.StopWatch=StopWatch,exports.logAsync=logAsync,exports.logSync=logSync;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2dpbmcvZGVjb3JhdG9ycy5qcyIsImxvZ2dpbmcvZGVjb3JhdG9ycy50cyJdLCJuYW1lcyI6WyJfX3NwcmVhZEFycmF5IiwidGhpcyIsInRvIiwiZnJvbSIsInBhY2siLCJsZW5ndGgiLCJpIiwibCIsImFyIiwiYXJndW1lbnRzIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJzbGljZSIsImNhbGwiLCJjb25jYXQiLCJlcnJvcnNfMSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwibG9nU3luYyIsImxvZ0FzeW5jIiwiU3RvcFdhdGNoIiwicmVxdWlyZSIsImxvZ2dpbmdfMSIsImNvbnN0YW50c18xIiwic3RhcnQiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwiY2hlY2siLCJFcnJvciIsInN0b3AiLCJyZXN1bHQiLCJ1bmRlZmluZWQiLCJsZXZlbCIsImJlbmNobWFyayIsIkxPR0dFUl9MRVZFTFMiLCJERUJVRyIsInRhcmdldCIsInByb3BlcnR5S2V5IiwiZGVzY3JpcHRvciIsIm9yaWdpbmFsTWV0aG9kIiwiYXJncyIsIl9pIiwiY2FsbGJhY2siLCJwb3AiLCJDcml0aWNhbEVycm9yIiwic3RvcFdhdGNoIiwibmFtZSIsImNvbnN0cnVjdG9yIiwiZ2V0TG9nZ2VyIiwicmVwb3J0IiwibWFwIiwiYSIsInRvU3RyaW5nIiwiam9pbiIsImFwcGx5IiwiX19vcmlnaW5hbE9iamVjdCIsImVyciIsInJlc3VsdHMiLCJlIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFJQSxjQUFpQkMsTUFBUUEsS0FBS0QsZUFBa0IsU0FBVUUsRUFBSUMsRUFBTUMsR0FBcEVKLEdBQUFBLEdBQThCQSxJQUE5QkEsVUFBaUJLLE9BQWFMLElBQUFBLElBQXNDSSxFQUFwREUsRUFBZ0MsRUFBQUMsRUFBVUwsRUFBSUMsT0FBWUcsRUFBQUMsRUFBQUQsS0FDbEVFLEdBQUlDLEtBQVVKLEtBQ0RGLEVBQUpLLEdBQWJFLE1BQXdCQyxVQUFBQyxNQUFBQyxL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aUJELEVBQVd0QixNQTRCbENzQixFQUFXdEIsTUExQlcsV0Q3QmxCLElDNkJzQyxJQUFBd0IsRUFBQSxHQUFBQyxFQUFBLEVBQUFBLEVBQUFuQyxVQUFBSixPQUFBdUMsSUFBQUQsRUFBQUMsR0FBQW5DLFVBQUFtQyxHQUN0QyxJQUtJWCxFQUxFZ0IsRUFBT2hELEtBQUtnRCxNQUFzQixhQUFkaEQsS0FBS2dELEtBQXNCaEQsS0FBS2dELEtBQU9oRCxLQUFLaUQsYUFBZWpELEtBQUtpRCxZQUFZRCxNQUFRaEQsS0FHMUcrQyxJQURKLEVBQUF4QixVQUFBMkIsYUFBWUMsT0FBTyw2Q0FBOENqQixFQUFpQmMsRUFBTVQsRUFBYUcsRUFBS1UsSUFBSSxTQUFBQyxHQUFLLE9BQUFBLEVBQUVDLGFBQVlDLEtBQUssYUFDL0Z0QixHQUduQ0UsSUFDQVksRUFBWSxJQUFJMUIsV0FDTkksUUFHZCxJQUNJTyxFQUFTUyxFQUFlN0IsS0FBSTRDLE1BQW5CZixFQUFjMUMsY0FBQSxDQUFNQyxLQUFLeUQsa0JBQW9CekQsTUFBUzBDLEdBQUksSUFDckUsTUFBT2tCLEdBSUwsTUFISWIsSUFDQSxFQUFBeEIsVUFBQTJCLGFBQVlDLE9BQU8sb0RBQXFEakIsRUFBaUJjLEVBQU1ULEVBQWFRLEVBQVVoQixTQUMxSCxFQUFBUixVQUFBMkIsYUFBWUMsT0FBTyxtREFBb0RqQixFQUFpQmMsRUFBTVQsRUFBYXFCLEdBQ3JHQSxFQUtWLE9BSEliLElBQ0EsRUFBQXhCLFVBQUEyQixhQUFZQyxPQUFPLG9EQUFxRGpCLEVBQWlCYyxFQUFNVCxFQUFhUSxFQUFVaEIsU0FDMUgsRUFBQVIsVUFBQTJCLGFBQVlDLE9BQU8sK0NBQWdEakIsRUFBaUJjLEVBQU1ULEVBQWFQLEdBQWtCLFFBQ2xIQSxJQWpJTmYsUUFBQUksVUFBQUEsVUF3Q2JKLFFBQUFHLFNBQUFBLFNBdURBSCxRQUFBRSxRQUFBQSIsImZpbGUiOiJsb2dnaW5nL2RlY29yYXRvcnMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheSA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheSkgfHwgZnVuY3Rpb24gKHRvLCBmcm9tLCBwYWNrKSB7XG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xuICAgICAgICAgICAgaWYgKCFhcikgYXIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChmcm9tLCAwLCBpKTtcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmxvZ1N5bmMgPSBleHBvcnRzLmxvZ0FzeW5jID0gZXhwb3J0cy5TdG9wV2F0Y2ggPSB2b2lkIDA7XG52YXIgZXJyb3JzXzEgPSByZXF1aXJlKFwiLi4vZXJyb3JzXCIpO1xudmFyIGxvZ2dpbmdfMSA9IHJlcXVpcmUoXCIuL2xvZ2dpbmdcIik7XG52YXIgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG52YXIgU3RvcFdhdGNoID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTdG9wV2F0Y2goKSB7XG4gICAgfVxuICAgIFN0b3BXYXRjaC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB9O1xuICAgIFN0b3BXYXRjaC5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGFydFRpbWUpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1N0b3BXYXRjaCBkaWRudCBzdGFydCcpO1xuICAgICAgICByZXR1cm4gRGF0ZS5ub3coKSAtIHRoaXMuc3RhcnRUaW1lO1xuICAgIH07XG4gICAgU3RvcFdhdGNoLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5jaGVjaygpO1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuICAgIHJldHVybiBTdG9wV2F0Y2g7XG59KCkpO1xuZXhwb3J0cy5TdG9wV2F0Y2ggPSBTdG9wV2F0Y2g7XG5mdW5jdGlvbiBsb2dBc3luYyhsZXZlbCwgYmVuY2htYXJrKSB7XG4gICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsgbGV2ZWwgPSBjb25zdGFudHNfMS5MT0dHRVJfTEVWRUxTLkRFQlVHOyB9XG4gICAgaWYgKCFiZW5jaG1hcmsgJiYgdHlwZW9mIGxldmVsID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgYmVuY2htYXJrID0gbGV2ZWw7XG4gICAgICAgIGxldmVsID0gY29uc3RhbnRzXzEuTE9HR0VSX0xFVkVMUy5ERUJVRztcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIHByb3BlcnR5S2V5LCBkZXNjcmlwdG9yKSB7XG4gICAgICAgIHZhciBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgICAgIHZhciBtZXRob2RXcmFwcGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICAgICAgICAgIGlmICghY2FsbGJhY2sgfHwgdHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBlcnJvcnNfMS5Dcml0aWNhbEVycm9yKFwiTWlzc2luZyBDYWxsYmFja1wiKTtcbiAgICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5uYW1lICYmIHRoaXMubmFtZSAhPT0gJ0Z1bmN0aW9uJyA/IHRoaXMubmFtZSA6IHRoaXMuY29uc3RydWN0b3IgJiYgdGhpcy5jb25zdHJ1Y3Rvci5uYW1lIHx8IHRoaXM7XG4gICAgICAgICAgICAoMCwgbG9nZ2luZ18xLmdldExvZ2dlcikoKS5yZXBvcnQoXCJbezB9XSAtIEVudGVyaW5nIE1ldGhvZCB7MX0gd2l0aCBhcmdzOiB7Mn1cIiwgbGV2ZWwsIG5hbWUsIHByb3BlcnR5S2V5LCBhcmdzLm1hcChmdW5jdGlvbiAoYSkgeyByZXR1cm4gYS50b1N0cmluZygpOyB9KS5qb2luKCcgfCAnKSk7XG4gICAgICAgICAgICB2YXIgc3RvcFdhdGNoO1xuICAgICAgICAgICAgdmFyIGNiID0gZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHN0b3BXYXRjaClcbiAgICAgICAgICAgICAgICAgICAgKDAsIGxvZ2dpbmdfMS5nZXRMb2dnZXIpKCkucmVwb3J0KFwiW3swfV1bQkVOQ0hNQVJLXSAtIExlYXZpbmcgTWV0aG9kIHsxfSBhZnRlciB7Mn1tc1wiLCBsZXZlbCwgbmFtZSwgcHJvcGVydHlLZXksIHN0b3BXYXRjaC5zdG9wKCkpO1xuICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgKDAsIGxvZ2dpbmdfMS5nZXRMb2dnZXIpKCkucmVwb3J0KFwiW3swfV1bRVJST1JdIC0gTGVhdmluZyBNZXRob2QgezF9IHdpdGggZXJyb3IgezJ9XCIsIGxldmVsLCBuYW1lLCBwcm9wZXJ0eUtleSwgZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICgwLCBsb2dnaW5nXzEuZ2V0TG9nZ2VyKSgpLnJlcG9ydChcIlt7MH1dIC0gTGVhdmluZyBNZXRob2QgezF9IHdpdGggcmVzdWx0czogezJ9XCIsIGxldmVsLCBuYW1lLCBwcm9wZXJ0eUtleSwgcmVzdWx0cyA/IHJlc3VsdHMubWFwKGZ1bmN0aW9uIChhKSB7IHJldHVybiBhLnRvU3RyaW5nKCk7IH0pLmpvaW4oJyB8ICcpIDogXCJ2b2lkXCIpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHZvaWQgMCwgX19zcHJlYWRBcnJheShbdW5kZWZpbmVkXSwgcmVzdWx0cywgZmFsc2UpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoYmVuY2htYXJrKSB7XG4gICAgICAgICAgICAgICAgc3RvcFdhdGNoID0gbmV3IFN0b3BXYXRjaCgpO1xuICAgICAgICAgICAgICAgIHN0b3BXYXRjaC5zdGFydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3JpZ2luYWxNZXRob2QuY2FsbC5hcHBseShvcmlnaW5hbE1ldGhvZCwgX19zcHJlYWRBcnJheShfX3NwcmVhZEFycmF5KFt0aGlzLl9fb3JpZ2luYWxPYmplY3QgfHwgdGhpc10sIGFyZ3MsIGZhbHNlKSwgW2NiXSwgZmFsc2UpKTtcbiAgICAgICAgfTtcbiAgICAgICAgZGVzY3JpcHRvci52YWx1ZSA9IG1ldGhvZFdyYXBwZXI7XG4gICAgfTtcbn1cbmV4cG9ydHMubG9nQXN5bmMgPSBsb2dBc3luYztcbmZ1bmN0aW9uIGxvZ1N5bmMobGV2ZWwsIGJlbmNobWFyaykge1xuICAgIGlmIChsZXZlbCA9PT0gdm9pZCAwKSB7IGxldmVsID0gY29uc3RhbnRzXzEuTE9HR0VSX0xFVkVMUy5ERUJVRzsgfVxuICAgIGlmICghYmVuY2htYXJrICYmIHR5cGVvZiBsZXZlbCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIGJlbmNobWFyayA9IGxldmVsO1xuICAgICAgICBsZXZlbCA9IGNvbnN0YW50c18xLkxPR0dFUl9MRVZFTFMuREVCVUc7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBwcm9wZXJ0eUtleSwgZGVzY3JpcHRvcikge1xuICAgICAgICB2YXIgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xuICAgICAgICB2YXIgbWV0aG9kV3JhcHBlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBuYW1lID0gdGhpcy5uYW1lICYmIHRoaXMubmFtZSAhPT0gJ0Z1bmN0aW9uJyA/IHRoaXMubmFtZSA6IHRoaXMuY29uc3RydWN0b3IgJiYgdGhpcy5jb25zdHJ1Y3Rvci5uYW1lIHx8IHRoaXM7XG4gICAgICAgICAgICAoMCwgbG9nZ2luZ18xLmdldExvZ2dlcikoKS5yZXBvcnQoXCJbezB9XSAtIEVudGVyaW5nIE1ldGhvZCB7MX0gd2l0aCBhcmdzOiB7Mn1cIiwgbGV2ZWwsIG5hbWUsIHByb3BlcnR5S2V5LCBhcmdzLm1hcChmdW5jdGlvbiAoYSkgeyByZXR1cm4gYS50b1N0cmluZygpOyB9KS5qb2luKCcgfCAnKSk7XG4gICAgICAgICAgICB2YXIgc3RvcFdhdGNoID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdmFyIHJlc3VsdDtcbiAgICAgICAgICAgIGlmIChiZW5jaG1hcmspIHtcbiAgICAgICAgICAgICAgICBzdG9wV2F0Y2ggPSBuZXcgU3RvcFdhdGNoKCk7XG4gICAgICAgICAgICAgICAgc3RvcFdhdGNoLnN0YXJ0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IG9yaWdpbmFsTWV0aG9kLmNhbGwuYXBwbHkob3JpZ2luYWxNZXRob2QsIF9fc3ByZWFkQXJyYXkoW3RoaXMuX19vcmlnaW5hbE9iamVjdCB8fCB0aGlzXSwgYXJncywgZmFsc2UpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0b3BXYXRjaClcbiAgICAgICAgICAgICAgICAgICAgKDAsIGxvZ2dpbmdfMS5nZXRMb2dnZXIpKCkucmVwb3J0KFwiW3swfV1bQkVOQ0hNQVJLXSAtIExlYXZpbmcgTWV0aG9kIHsxfSBhZnRlciB7Mn1tc1wiLCBsZXZlbCwgbmFtZSwgcHJvcGVydHlLZXksIHN0b3BXYXRjaC5zdG9wKCkpO1xuICAgICAgICAgICAgICAgICgwLCBsb2dnaW5nXzEuZ2V0TG9nZ2VyKSgpLnJlcG9ydChcIlt7MH1dW0VSUk9SXSAtIExlYXZpbmcgTWV0aG9kIHsxfSB3aXRoIGVycm9yIHsyfVwiLCBsZXZlbCwgbmFtZSwgcHJvcGVydHlLZXksIGUpO1xuICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3RvcFdhdGNoKVxuICAgICAgICAgICAgICAgICgwLCBsb2dnaW5nXzEuZ2V0TG9nZ2VyKSgpLnJlcG9ydChcIlt7MH1dW0JFTkNITUFSS10gLSBMZWF2aW5nIE1ldGhvZCB7MX0gYWZ0ZXIgezJ9bXNcIiwgbGV2ZWwsIG5hbWUsIHByb3BlcnR5S2V5LCBzdG9wV2F0Y2guc3RvcCgpKTtcbiAgICAgICAgICAgICgwLCBsb2dnaW5nXzEuZ2V0TG9nZ2VyKSgpLnJlcG9ydChcIlt7MH1dIC0gTGVhdmluZyBNZXRob2QgezF9IHdpdGggcmVzdWx0czogezJ9XCIsIGxldmVsLCBuYW1lLCBwcm9wZXJ0eUtleSwgcmVzdWx0ID8gcmVzdWx0IDogXCJ2b2lkXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfTtcbiAgICAgICAgZGVzY3JpcHRvci52YWx1ZSA9IG1ldGhvZFdyYXBwZXI7XG4gICAgfTtcbn1cbmV4cG9ydHMubG9nU3luYyA9IGxvZ1N5bmM7IiwiaW1wb3J0IHtDcml0aWNhbEVycm9yfSBmcm9tIFwiLi4vZXJyb3JzXCI7XG5pbXBvcnQge2dldExvZ2dlcn0gZnJvbSBcIi4vbG9nZ2luZ1wiO1xuaW1wb3J0IHtDYWxsYmFjaywgRXJyLCBMT0dHRVJfTEVWRUxTfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcblxuLyoqXG4gKiBVdGlsIGNsYXNzIHRvIG1lYXN1cmUgdGltZSBiZXR3ZWVuIHR3byBwb2ludHMgaW4gdGltZTtcbiAqXG4gKiBAY2xhc3MgU3RvcFdhdGNoXG4gKlxuICovXG5leHBvcnQgY2xhc3MgU3RvcFdhdGNoe1xuICAgIHByaXZhdGUgc3RhcnRUaW1lPzogbnVtYmVyO1xuXG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBzdGFydCB0aW1lXG4gICAgICovXG4gICAgc3RhcnQoKXtcbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHJldHVybnMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBub3cgYW5kIHRoZSBzdGFydCB0aW1lXG4gICAgICovXG4gICAgY2hlY2soKTogbnVtYmVyIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXJ0VGltZSlcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU3RvcFdhdGNoIGRpZG50IHN0YXJ0Jyk7XG4gICAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gdGhpcy5zdGFydFRpbWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcmV0dXJucyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIG5vdyBhbmQgdGhlIHN0YXJ0IHRpbWVcbiAgICAgKiBzdG9wcyB0aGUgVGltZVdhdGNoXG4gICAgICovXG4gICAgc3RvcCgpOiBudW1iZXIge1xuICAgICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmNoZWNrKCk7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBBc3luYyBNZXRob2QgZGVjb3JhdG9yIHRvIGxvZyB0aGUgaW5wdXQgYW5kIG91dHB1dCBvZiB0aGF0IG1ldGhvZFxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfSBbbGV2ZWxdIExvZ2dpbmcgTGV2ZWwgYXMgaW4ge0BsaW5rIExPR0dFUl9MRVZFTFN9IGRlZmF1bHRzIHRvIHtAbGluayBMT0dHRVJfTEVWRUxTLkRFQlVHfVxuICogQHBhcmFtIHtib29sZWFufSBbYmVuY2htYXJrXSBkZXRlcm1pbmVzIGlmIHRoZSBsb2dnaW5nIGluY2x1ZGVzIHRoZSBkdXJhdGlvbiBpbiBtcy4gZGVmYXVsdHMgdG8gZmFsc2VcbiAqXG4gKiBAZGVjb3JhdG9yIGxvZ0FzeW5jXG4gKlxuICogQGNhdGVnb3J5IERlY29yYXRvcnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvZ0FzeW5jKGxldmVsOiBudW1iZXIgfCBib29sZWFuID0gTE9HR0VSX0xFVkVMUy5ERUJVRywgYmVuY2htYXJrPzogYm9vbGVhbikge1xuXG4gICAgaWYgKCFiZW5jaG1hcmsgJiYgdHlwZW9mIGxldmVsID09PSAnYm9vbGVhbicpe1xuICAgICAgICBiZW5jaG1hcmsgPSBsZXZlbDtcbiAgICAgICAgbGV2ZWwgPSBMT0dHRVJfTEVWRUxTLkRFQlVHO1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikge1xuXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcblxuICAgICAgICBjb25zdCBtZXRob2RXcmFwcGVyID0gZnVuY3Rpb24odGhpczogYW55LCAuLi5hcmdzOiBhbnlbXSl7XG4gICAgICAgICAgICBsZXQgY2FsbGJhY2s6IENhbGxiYWNrID0gYXJncy5wb3AoKTtcbiAgICAgICAgICAgIGlmICghY2FsbGJhY2sgfHwgdHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBDcml0aWNhbEVycm9yKGBNaXNzaW5nIENhbGxiYWNrYCk7XG5cbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0aGlzLm5hbWUgJiYgdGhpcy5uYW1lICE9PSAnRnVuY3Rpb24nID8gdGhpcy5uYW1lIDogdGhpcy5jb25zdHJ1Y3RvciAmJiB0aGlzLmNvbnN0cnVjdG9yLm5hbWUgfHwgdGhpcztcbiAgICAgICAgICAgIGdldExvZ2dlcigpLnJlcG9ydChgW3swfV0gLSBFbnRlcmluZyBNZXRob2QgezF9IHdpdGggYXJnczogezJ9YCwgbGV2ZWwgYXMgbnVtYmVyLCBuYW1lLCBwcm9wZXJ0eUtleSwgYXJncy5tYXAoYSA9PiBhLnRvU3RyaW5nKCkpLmpvaW4oJyB8ICcpKTtcblxuICAgICAgICAgICAgbGV0IHN0b3BXYXRjaDogU3RvcFdhdGNoO1xuXG4gICAgICAgICAgICBjb25zdCBjYiA9IChlcnI6IEVyciwgLi4ucmVzdWx0czogYW55W10pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoc3RvcFdhdGNoKVxuICAgICAgICAgICAgICAgICAgICBnZXRMb2dnZXIoKS5yZXBvcnQoYFt7MH1dW0JFTkNITUFSS10gLSBMZWF2aW5nIE1ldGhvZCB7MX0gYWZ0ZXIgezJ9bXNgLCBsZXZlbCBhcyBudW1iZXIsIG5hbWUsIHByb3BlcnR5S2V5LCBzdG9wV2F0Y2guc3RvcCgpKTtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKXtcbiAgICAgICAgICAgICAgICAgICAgZ2V0TG9nZ2VyKCkucmVwb3J0KGBbezB9XVtFUlJPUl0gLSBMZWF2aW5nIE1ldGhvZCB7MX0gd2l0aCBlcnJvciB7Mn1gLCBsZXZlbCBhcyBudW1iZXIsIG5hbWUsIHByb3BlcnR5S2V5LCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBnZXRMb2dnZXIoKS5yZXBvcnQoYFt7MH1dIC0gTGVhdmluZyBNZXRob2QgezF9IHdpdGggcmVzdWx0czogezJ9YCwgbGV2ZWwgYXMgbnVtYmVyLCBuYW1lLCBwcm9wZXJ0eUtleSwgcmVzdWx0cyA/IHJlc3VsdHMubWFwKGEgPT4gYS50b1N0cmluZygpKS5qb2luKCcgfCAnKSA6IFwidm9pZFwiKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIC4uLnJlc3VsdHMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYmVuY2htYXJrKXtcbiAgICAgICAgICAgICAgICBzdG9wV2F0Y2ggPSBuZXcgU3RvcFdhdGNoKCk7XG4gICAgICAgICAgICAgICAgc3RvcFdhdGNoLnN0YXJ0KCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG9yaWdpbmFsTWV0aG9kLmNhbGwodGhpcy5fX29yaWdpbmFsT2JqZWN0IHx8IHRoaXMsIC4uLmFyZ3MsIGNiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGRlc2NyaXB0b3IudmFsdWUgPSBtZXRob2RXcmFwcGVyO1xuICAgIH1cbn1cblxuLyoqXG4gKiBTeW5jIE1ldGhvZCBkZWNvcmF0b3IgdG8gbG9nIHRoZSBpbnB1dCBhbmQgb3V0cHV0IG9mIHRoYXQgbWV0aG9kXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IFtsZXZlbF0gTG9nZ2luZyBMZXZlbCBhcyBpbiB7QGxpbmsgTE9HR0VSX0xFVkVMU30gZGVmYXVsdHMgdG8ge0BsaW5rIExPR0dFUl9MRVZFTFMuREVCVUd9XG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtiZW5jaG1hcmtdIGRldGVybWluZXMgaWYgdGhlIGxvZ2dpbmcgaW5jbHVkZXMgdGhlIGR1cmF0aW9uIGluIG1zLiBkZWZhdWx0cyB0byBmYWxzZVxuICpcbiAqIEBkZWNvcmF0b3IgbG9nU3luY1xuICpcbiAqIEBjYXRlZ29yeSBEZWNvcmF0b3JzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2dTeW5jKGxldmVsOiBudW1iZXIgfCBib29sZWFuID0gTE9HR0VSX0xFVkVMUy5ERUJVRywgYmVuY2htYXJrPzogYm9vbGVhbikge1xuXG4gICAgaWYgKCFiZW5jaG1hcmsgJiYgdHlwZW9mIGxldmVsID09PSAnYm9vbGVhbicpe1xuICAgICAgICBiZW5jaG1hcmsgPSBsZXZlbDtcbiAgICAgICAgbGV2ZWwgPSBMT0dHRVJfTEVWRUxTLkRFQlVHO1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0OiBhbnksIHByb3BlcnR5S2V5OiBzdHJpbmcsIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcikge1xuXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcblxuICAgICAgICBjb25zdCBtZXRob2RXcmFwcGVyID0gZnVuY3Rpb24odGhpczogYW55LCAuLi5hcmdzOiBhbnlbXSl7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gdGhpcy5uYW1lICYmIHRoaXMubmFtZSAhPT0gJ0Z1bmN0aW9uJyA/IHRoaXMubmFtZSA6IHRoaXMuY29uc3RydWN0b3IgJiYgdGhpcy5jb25zdHJ1Y3Rvci5uYW1lIHx8IHRoaXM7XG5cbiAgICAgICAgICAgIGdldExvZ2dlcigpLnJlcG9ydChgW3swfV0gLSBFbnRlcmluZyBNZXRob2QgezF9IHdpdGggYXJnczogezJ9YCwgbGV2ZWwgYXMgbnVtYmVyLCBuYW1lLCBwcm9wZXJ0eUtleSwgYXJncy5tYXAoYSA9PiBhLnRvU3RyaW5nKCkpLmpvaW4oJyB8ICcpKTtcbiAgICAgICAgICAgIGxldCBzdG9wV2F0Y2g6IFN0b3BXYXRjaCB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgbGV0IHJlc3VsdDtcbiAgICAgICAgICAgIGlmIChiZW5jaG1hcmspe1xuICAgICAgICAgICAgICAgIHN0b3BXYXRjaCA9IG5ldyBTdG9wV2F0Y2goKTtcbiAgICAgICAgICAgICAgICBzdG9wV2F0Y2guc3RhcnQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBvcmlnaW5hbE1ldGhvZC5jYWxsKHRoaXMuX19vcmlnaW5hbE9iamVjdCB8fCB0aGlzLCAuLi5hcmdzKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RvcFdhdGNoKVxuICAgICAgICAgICAgICAgICAgICBnZXRMb2dnZXIoKS5yZXBvcnQoYFt7MH1dW0JFTkNITUFSS10gLSBMZWF2aW5nIE1ldGhvZCB7MX0gYWZ0ZXIgezJ9bXNgLCBsZXZlbCBhcyBudW1iZXIsIG5hbWUsIHByb3BlcnR5S2V5LCBzdG9wV2F0Y2guc3RvcCgpKTtcbiAgICAgICAgICAgICAgICBnZXRMb2dnZXIoKS5yZXBvcnQoYFt7MH1dW0VSUk9SXSAtIExlYXZpbmcgTWV0aG9kIHsxfSB3aXRoIGVycm9yIHsyfWAsIGxldmVsIGFzIG51bWJlciwgbmFtZSwgcHJvcGVydHlLZXksIGUpO1xuICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc3RvcFdhdGNoKVxuICAgICAgICAgICAgICAgIGdldExvZ2dlcigpLnJlcG9ydChgW3swfV1bQkVOQ0hNQVJLXSAtIExlYXZpbmcgTWV0aG9kIHsxfSBhZnRlciB7Mn1tc2AsIGxldmVsIGFzIG51bWJlciwgbmFtZSwgcHJvcGVydHlLZXksIHN0b3BXYXRjaC5zdG9wKCkpO1xuICAgICAgICAgICAgZ2V0TG9nZ2VyKCkucmVwb3J0KGBbezB9XSAtIExlYXZpbmcgTWV0aG9kIHsxfSB3aXRoIHJlc3VsdHM6IHsyfWAsIGxldmVsIGFzIG51bWJlciwgbmFtZSwgcHJvcGVydHlLZXksIHJlc3VsdCA/IHJlc3VsdCA6IFwidm9pZFwiKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICBkZXNjcmlwdG9yLnZhbHVlID0gbWV0aG9kV3JhcHBlcjtcbiAgICB9XG59XG4iXX0=
